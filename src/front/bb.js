function BounceBlock(a){this.config={step:[],url:a?"http://beta.bounceblock.com":"http://bb.bounceblock.com",config:false,holder:"bounceblock-layer",popup:"bounceblock-wrapper",content:"bounceblock-inner",close:"bounceblock-close",style:"bounceblock-style",form:"bounceblock-form"};this.start_time=new Date().getTime();this.done=false;this.datas=false;this.id=false;this.load=function(d){this.id=d;document.onmouseout=this.leaving;var c=document.createElement("script");c.type="text/javascript";c.async=true;c.src=this.config.url+"/bb/api/"+d+"/c";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(c,b)};this.set_datas=function(b){this.datas=b};this.send_event=function(d,e){if(this.id===false){return}e=e||"";var c=this.config.url+"/bb/api/"+this.id;c+="/"+d+"/"+e;var b=document.createElement("img");b.setAttribute("src",c);b.setAttribute("width",0);b.setAttribute("height",0);document.body.appendChild(b)};this.show_popup=function(k,c,d,g){var f=document.getElementById(this.config.holder);if(f){document.body.removeChild(f)}var l=document.head||document.getElementsByTagName("head")[0],f=document.getElementById(this.config.style);if(f){l.removeChild(f)}var j=[];j.push('<div id="',this.config.popup,'">');j.push('<div id="',this.config.content,'">',k,"</div>");j.push('<a style="z-index:200" id="',this.config.close,'" href="#">close</a>');j.push("</div>");j.push('<div id="bounceblock-poweredby"><a href="http://www.bounceblock.com" target="_blank">Powered by <span>BounceBlock</span></a></div>');var n=document.createElement("style");n.type="text/css";n.setAttribute("id",this.config.style);if(n.styleSheet){n.styleSheet.cssText=c}else{n.appendChild(document.createTextNode(c))}l.appendChild(n);var b=document.createElement("div");b.setAttribute("id",this.config.holder);b.innerHTML=j.join("");document.body.appendChild(b);var e=document.getElementById(this.config.form);if(e&&d){e.setAttribute("method","POST");e.setAttribute("action","http://bb.bounceblock.com/bb/add_datas");var m=document.createElement("input");m.setAttribute("name","bb-popup");m.setAttribute("value",d);m.setAttribute("type","hidden");e.appendChild(m);if(g){m=document.createElement("input");m.setAttribute("name","bb-campaign");m.setAttribute("value",g);m.setAttribute("type","hidden");e.appendChild(m)}}this.send_event("s");this.done=true;this.set_events()};this.set_events=function(){document.getElementById(this.config.close).onclick=function(){var f=window.bounceblock;var c=document.getElementById(f.config.holder);document.body.removeChild(c);f.send_event("a",3)};document.getElementById(this.config.popup).onmouseover=function(){var c=window.bounceblock;c.send_event("a",2)};var e=document.getElementById(this.config.content).getElementsByTagName("a");for(i=0;i<e.length;i++){var b=e.item(i);var g=b.getAttribute("href");var j=b.getAttribute("class");if(j&&j.search("bounceblock-close")!=-1){b.onclick=function(){var f=window.bounceblock;var c=document.getElementById(f.config.holder);document.body.removeChild(c);f.send_event("a",3)}}else{b.onclick=function(){var c=window.bounceblock;c.send_event("a",4)}}}var d=document.getElementById(this.config.content).getElementsByTagName("form");for(i=0;i<d.length;i++){var h=d.item(i);h.onsubmit=function(){var c=window.bounceblock;c.send_event("a",4)}}};this.leaving=function(h){var j=window.bounceblock;if(j.done){return}if(!j.datas){return}var l=h.clientY;if(l>0){return}var f=new Date().getTime();var g=f-j.start_time;g=g/1000;var b=j.datas;for(var d in b){var k=b[d];if(g>=k.time){j.id=k.id;j.show_popup(k.html,k.css,k.p,k.c);return}}}}if(bounceblock_id){window.bounceblock=new BounceBlock(window.bounceblock_test);window.bounceblock.load(bounceblock_id)};